import sqlite3
import os

conn = sqlite3.connect('users.db')
cursor = conn.cursor()

cursor.execute('CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY AUTOINCREMENT, nome TEXT UNIQUE NOT NULL, senha TEXT NOT NULL)')
conn.commit()

arquivo = 'contas.txt'

if os.path.exists(arquivo):
    with open(arquivo, 'r') as f:
        linhas = f.readlines()

    contas = [linha.strip().split(':') for linha in linhas if ':' in linha]

    try:
        cursor.executemany('INSERT OR IGNORE INTO users (nome, senha) VALUES (?, ?)', contas)
        conn.commit()
        print(f"{cursor.rowcount} contas adicionadas.")
    except Exception as e:
        print("Erro ao inserir contas:", e)

    # Apaga o arquivo após a leitura
    os.remove(arquivo)
    print(f"Arquivo '{arquivo}' removido após a leitura.")
else:
    print(f"Arquivo '{arquivo}' não encontrado.")

conn.close()
